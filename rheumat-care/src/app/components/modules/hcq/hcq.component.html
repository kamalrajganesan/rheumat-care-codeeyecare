<div class="card module-card">
  <div class="moduleTitle">
    <h2>HCQ Screening</h2>
    <span class="pill" [class.ok]="completed">{{ completed ? 'Complete' : 'Pending' }}</span>
  </div>

  <form [formGroup]="hcqForm">
    <label for="screeningType">HCQ Screening Type</label>
    <select id="screeningType" formControlName="screeningType">
      <option value="">Select…</option>
      <option *ngFor="let type of screeningTypes" [value]="type">{{ type }}</option>
    </select>

    <div class="divider"></div>

    <h2 class="section-title">HCQ Dosing History</h2>

    <div formArrayName="dosingBlocks">
      <div *ngFor="let block of dosingBlocks.controls; let i = index" [formGroupName]="i" class="dosing-block">
        <label>Block {{ i + 1 }}</label>
        <div class="row">
          <div class="field">
            <input type="number" formControlName="dose" placeholder="Dose (mg/day)" min="0" />
          </div>
          <div class="field">
            <input type="number" formControlName="duration" placeholder="Duration (months)" min="0" />
          </div>
        </div>
      </div>
    </div>

    <div class="cumulative-dose">
      <label>Cumulative HCQ Dose</label>
      <div class="calculated-value">{{ cumulativeDose || '—' }}</div>
    </div>

    <div class="divider"></div>

    <label>Tests performed (tick all)</label>
    <div class="checks">
      <label *ngFor="let test of tests" class="check">
        <input
          type="checkbox"
          [checked]="isTestChecked(test)"
          (change)="onTestChange(test, $event)"
        />
        <span>{{ test }}</span>
      </label>
    </div>

    <div class="divider"></div>

    <label for="toxicitySigns">Signs of Toxicity</label>
    <select id="toxicitySigns" formControlName="toxicitySigns">
      <option value="">Select…</option>
      <option *ngFor="let option of toxicityOptions" [value]="option">{{ option }}</option>
    </select>

    <label for="notes">Notes</label>
    <textarea id="notes" formControlName="notes"></textarea>

    <div class="divider"></div>
    <button class="primary" type="button" (click)="markComplete()">Mark HCQ Screening complete</button>
  </form>
</div>
